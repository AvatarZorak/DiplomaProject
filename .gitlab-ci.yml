stages:
  - testing
  - build

test:
  stage: testing
  script:
    - echo "$ACCOUNT_ID"
  tags:
    - ci-shared

build-frontend-image:
  stage: build
  image: docker:latest
  services:
      - docker:dind
  script:
    - aws ecr get-login-password --region=eu-central-1 | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.eu-central-1.amazonaws.com
    - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.eu-central-1.amazonaws.com/ah-frontend-repository:$CI_PIPELINE_IID ./frontend
  rules:
      - changes:
          - ./frontend/test
  tags:
      - ci-shared

build-backend-image:
  stage: build
  image: docker:latest
  services:
      - docker:dind
  script:
    - aws ecr get-login-password --region=eu-central-1 | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.eu-central-1.amazonaws.com
    - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.eu-central-1.amazonaws.com/ah-backend-repository:$CI_PIPELINE_IID ./backend
  rules:
      - changes:
          - web-application/backend/**/*
  tags:
      - ci-shared